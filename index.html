<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ingen IndkÃ¸b">
<meta name="theme-color" content="#0d0d12">
<title>Ingen IndkÃ¸b</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d0d12;
    --card: #ffffff08;
    --border: #ffffff10;
    --text: #ffffff;
    --muted: #ffffff50;
    --dim: #ffffff25;
    --level-color: #7ecf8e;
  }

  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Serif Display', Georgia, serif;
    min-height: 100vh;
    min-height: -webkit-fill-available;
    overscroll-behavior: none;
    -webkit-tap-highlight-color: transparent;
  }

  .app {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: env(safe-area-inset-top, 48px) 20px env(safe-area-inset-bottom, 24px);
    padding-top: max(env(safe-area-inset-top), 48px);
    overflow-y: auto;
    position: relative;
  }

  .glow {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    width: 500px;
    height: 500px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--level-glow, #7ecf8e22) 0%, transparent 70%);
    pointer-events: none;
    transition: background 1.2s ease;
    z-index: 0;
  }

  .content {
    width: 100%;
    max-width: 400px;
    position: relative;
    z-index: 1;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 28px;
    animation: slide-up 0.5s ease;
  }
  .header-label {
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .header h1 {
    font-size: 34px;
    font-weight: 400;
    line-height: 1.15;
  }
  .header h1 em { font-style: italic; }

  /* Level card */
  .level-card {
    background: var(--card);
    border: 1px solid var(--level-border, #7ecf8e44);
    border-radius: 16px;
    padding: 16px 18px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: border-color 1s ease;
    animation: slide-up 0.55s ease;
  }
  .level-emoji {
    font-size: 30px;
    animation: float 3s ease-in-out infinite;
    flex-shrink: 0;
  }
  .level-info { flex: 1; min-width: 0; }
  .level-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }
  .level-name {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--level-color);
    transition: color 1s ease;
  }
  .level-next {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    color: var(--dim);
    white-space: nowrap;
  }
  .progress-bar {
    height: 4px;
    background: #ffffff10;
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--level-color-soft, #7ecf8e88), var(--level-color));
    transition: width 0.8s ease, background 1s ease;
  }

  /* Stats */
  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 12px;
    animation: slide-up 0.6s ease;
  }
  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 18px 14px;
    text-align: center;
  }
  .stat-value {
    font-size: 38px;
    font-weight: 400;
    line-height: 1;
    color: var(--text);
  }
  .stat-value.green { color: #7ecf8e; font-size: 26px; }
  .stat-label {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 4px;
  }

  /* Budget */
  .budget-row {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    animation: slide-up 0.65s ease;
  }
  .budget-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }
  .budget-value {
    font-family: 'DM Mono', monospace;
    font-size: 16px;
    color: var(--text);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }
  .budget-edit {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .budget-input {
    background: #ffffff15;
    border: 1px solid #ffffff30;
    border-radius: 8px;
    padding: 6px 10px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 14px;
    width: 90px;
    outline: none;
    -webkit-appearance: none;
  }
  .budget-save {
    background: #7ecf8e22;
    border: 1px solid #7ecf8e55;
    color: #7ecf8e;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
  }

  /* Check-in button */
  .checkin-wrap {
    display: flex;
    justify-content: center;
    position: relative;
    margin-bottom: 12px;
    animation: slide-up 0.7s ease;
  }
  .pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 2px solid var(--level-color);
    animation: pulse-ring 2s ease-out infinite;
    transition: border-color 1s ease;
  }
  .checkin-btn {
    width: 190px;
    height: 190px;
    border-radius: 50%;
    border: 2px solid var(--level-color);
    background: radial-gradient(circle, var(--level-color-bg, #7ecf8e40), var(--level-color-bg2, #7ecf8e15));
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all 0.3s ease;
    box-shadow: 0 0 40px var(--level-glow2, #7ecf8e30);
    -webkit-tap-highlight-color: transparent;
    position: relative;
    z-index: 1;
  }
  .checkin-btn.done {
    border-color: var(--level-color-dim, #7ecf8e40);
    background: radial-gradient(circle, var(--level-color-done-bg, #7ecf8e20), var(--level-color-done-bg2, #7ecf8e08));
    box-shadow: none;
    cursor: default;
  }
  .checkin-btn:active:not(.done) { transform: scale(0.96); }
  .btn-emoji { font-size: 38px; }
  .btn-text {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }
  .btn-sub {
    font-family: 'DM Mono', monospace;
    font-size: 8px;
    color: var(--dim);
    letter-spacing: 1px;
  }

  .tomorrow-msg {
    text-align: center;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    color: var(--dim);
    margin-bottom: 16px;
  }

  /* Levels list */
  .levels-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px 18px;
    margin-bottom: 12px;
    animation: slide-up 0.75s ease;
  }
  .levels-title {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--dim);
    margin-bottom: 12px;
  }
  .level-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    transition: opacity 0.3s;
  }
  .level-row.locked { opacity: 0.25; }
  .level-row-emoji { font-size: 16px; }
  .level-row-name {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    flex: 1;
  }
  .level-row-range {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    color: var(--dim);
  }

  /* Reset */
  .reset-btn {
    width: 100%;
    padding: 12px;
    background: none;
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--dim);
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    cursor: pointer;
    letter-spacing: 2px;
    text-transform: uppercase;
    transition: color 0.2s;
    margin-bottom: 8px;
    animation: slide-up 0.8s ease;
  }
  .reset-btn:active { color: #f04080; }

  /* Install hint */
  .install-hint {
    text-align: center;
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    color: var(--dim);
    letter-spacing: 1px;
    padding-bottom: 8px;
  }

  /* Confetti */
  .confetti-piece {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 999;
    animation: confetti-fly 1.8s ease-out forwards;
  }

  /* Animations */
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-7px); }
  }
  @keyframes pulse-ring {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
    100% { transform: translate(-50%, -50%) scale(1.45); opacity: 0; }
  }
  @keyframes slide-up {
    from { opacity: 0; transform: translateY(18px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  @keyframes confetti-fly {
    to { opacity: 0; }
  }
</style>
</head>
<body>

<div class="glow" id="glow"></div>

<div class="app">
  <div class="content">
    <div class="header">
      <p class="header-label">Streak Tracker</p>
      <h1>Ingen IndkÃ¸b,<br><em>Flere Penge</em></h1>
    </div>

    <div class="level-card" id="levelCard">
      <div class="level-emoji" id="levelEmoji">ðŸŒ±</div>
      <div class="level-info">
        <div class="level-top">
          <span class="level-name" id="levelName">Nybegynder</span>
          <span class="level-next" id="levelNext"></span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width:0%"></div>
        </div>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="daysVal">0</div>
        <div class="stat-label">Dage</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="savedVal">0</div>
        <div class="stat-label">kr. sparet</div>
      </div>
    </div>

    <div class="budget-row">
      <span class="budget-label">Dagligt Budget</span>
      <div id="budgetDisplay">
        <button class="budget-value" id="budgetBtn" onclick="startEditBudget()"></button>
      </div>
    </div>

    <div class="checkin-wrap">
      <div class="pulse-ring" id="pulseRing"></div>
      <button class="checkin-btn" id="checkinBtn" onclick="handleCheckIn()">
        <span class="btn-emoji" id="btnEmoji">ðŸ›’</span>
        <span class="btn-text" id="btnText">Ingen indkÃ¸b</span>
        <span class="btn-sub" id="btnSub"></span>
      </button>
    </div>

    <p class="tomorrow-msg" id="tomorrowMsg" style="display:none">Kom igen i morgen ðŸŒ™</p>

    <div class="levels-card">
      <p class="levels-title">Level Guide</p>
      <div id="levelsList"></div>
    </div>

    <button class="reset-btn" onclick="handleReset()">Nulstil fremskridt</button>

    <p class="install-hint">Safari â†’ Del â†’ FÃ¸j til hjemmeskÃ¦rm</p>
  </div>
</div>

<script>
const LEVELS = [
  { name: "Nybegynder",    min: 0,  max: 2,        emoji: "ðŸŒ±", color: "#7ecf8e" },
  { name: "Sparsommelig",  min: 3,  max: 6,        emoji: "ðŸ’°", color: "#f0c040" },
  { name: "Disciplineret", min: 7,  max: 13,       emoji: "ðŸ”¥", color: "#f07040" },
  { name: "Mester",        min: 14, max: 29,       emoji: "âš¡", color: "#a070f0" },
  { name: "Legende",       min: 30, max: Infinity, emoji: "ðŸ‘‘", color: "#f04080" },
];

function loadState() {
  try {
    const s = localStorage.getItem("shoptracker_v2");
    return s ? JSON.parse(s) : { days: 0, dailyBudget: 150, lastChecked: null, totalSaved: 0 };
  } catch { return { days: 0, dailyBudget: 150, lastChecked: null, totalSaved: 0 }; }
}

function saveState(s) {
  try { localStorage.setItem("shoptracker_v2", JSON.stringify(s)); } catch {}
}

let state = loadState();

function getLevel(days) {
  return LEVELS.find(l => days >= l.min && days <= l.max) || LEVELS[0];
}
function getNextLevel(days) {
  const idx = LEVELS.findIndex(l => days >= l.min && days <= l.max);
  return idx < LEVELS.length - 1 ? LEVELS[idx + 1] : null;
}

function hex(color, alpha) {
  return color + Math.round(alpha * 255).toString(16).padStart(2, "0");
}

function render() {
  const { days, dailyBudget, lastChecked, totalSaved } = state;
  const today = new Date().toDateString();
  const done = lastChecked === today;
  const level = getLevel(days);
  const next = getNextLevel(days);
  const progress = next ? ((days - level.min) / (next.min - level.min)) * 100 : 100;

  // CSS vars for color
  document.documentElement.style.setProperty("--level-color", level.color);
  document.documentElement.style.setProperty("--level-glow", hex(level.color, 0.13));
  document.documentElement.style.setProperty("--level-glow2", hex(level.color, 0.19));
  document.documentElement.style.setProperty("--level-border", hex(level.color, 0.27));
  document.documentElement.style.setProperty("--level-color-soft", hex(level.color, 0.53));
  document.documentElement.style.setProperty("--level-color-bg", hex(level.color, 0.25));
  document.documentElement.style.setProperty("--level-color-bg2", hex(level.color, 0.08));
  document.documentElement.style.setProperty("--level-color-done-bg", hex(level.color, 0.12));
  document.documentElement.style.setProperty("--level-color-done-bg2", hex(level.color, 0.04));
  document.documentElement.style.setProperty("--level-color-dim", hex(level.color, 0.25));

  // Level card
  document.getElementById("levelEmoji").textContent = level.emoji;
  document.getElementById("levelName").textContent = level.name;
  document.getElementById("levelNext").textContent = next ? `â†’ ${next.name} om ${next.min - days} dag${next.min - days !== 1 ? "e" : ""}` : "Max niveau! ðŸŽ‰";
  document.getElementById("progressFill").style.width = progress + "%";

  // Stats
  document.getElementById("daysVal").textContent = days;
  document.getElementById("savedVal").textContent = totalSaved.toLocaleString("da-DK");

  // Budget
  document.getElementById("budgetBtn").textContent = dailyBudget.toLocaleString("da-DK") + " kr âœŽ";

  // Check-in btn
  const btn = document.getElementById("checkinBtn");
  if (done) {
    btn.classList.add("done");
    document.getElementById("btnEmoji").textContent = "âœ…";
    document.getElementById("btnText").textContent = "Registreret";
    document.getElementById("btnSub").textContent = "i dag";
    document.getElementById("pulseRing").style.display = "none";
    document.getElementById("tomorrowMsg").style.display = "block";
  } else {
    btn.classList.remove("done");
    document.getElementById("btnEmoji").textContent = "ðŸ›’";
    document.getElementById("btnText").textContent = "Ingen indkÃ¸b";
    document.getElementById("btnSub").textContent = "";
    document.getElementById("pulseRing").style.display = "block";
    document.getElementById("tomorrowMsg").style.display = "none";
  }

  // Levels list
  const list = document.getElementById("levelsList");
  list.innerHTML = LEVELS.map(l => `
    <div class="level-row ${days >= l.min ? "" : "locked"}">
      <span class="level-row-emoji">${l.emoji}</span>
      <span class="level-row-name" style="color:${l.color}">${l.name}</span>
      <span class="level-row-range">${l.max === Infinity ? l.min + "+ dage" : l.min + "â€“" + l.max + " dage"}</span>
    </div>
  `).join("");
}

function spawnConfetti() {
  const colors = ["#f04080","#f0c040","#7ecf8e","#a070f0","#f07040","#40c0f0"];
  for (let i = 0; i < 20; i++) {
    const el = document.createElement("div");
    el.className = "confetti-piece";
    const dx = (Math.random() - 0.5) * 320;
    const dy = -(Math.random() * 300 + 120);
    el.style.cssText = `
      background: ${colors[i % colors.length]};
      border-radius: ${i % 2 === 0 ? "50%" : "2px"};
      animation-duration: ${1.4 + Math.random() * 0.8}s;
      transform: translate(-50%, -50%);
    `;
    el.animate([
      { transform: "translate(-50%, -50%) rotate(0deg)", opacity: 1 },
      { transform: `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) rotate(${720 * (Math.random() > 0.5 ? 1 : -1)}deg)`, opacity: 0 }
    ], { duration: 1600 + Math.random() * 600, easing: "ease-out", fill: "forwards" });
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2400);
  }
}

function handleCheckIn() {
  const today = new Date().toDateString();
  if (state.lastChecked === today) return;
  state.days += 1;
  state.lastChecked = today;
  state.totalSaved += state.dailyBudget;
  saveState(state);
  spawnConfetti();
  const btn = document.getElementById("checkinBtn");
  btn.animate([{ transform: "scale(1)" }, { transform: "scale(1.1)" }, { transform: "scale(1)" }], { duration: 400 });
  render();
}

function startEditBudget() {
  const display = document.getElementById("budgetDisplay");
  display.innerHTML = `
    <div class="budget-edit">
      <input class="budget-input" type="number" id="budgetInput" value="${state.dailyBudget}" inputmode="decimal">
      <button class="budget-save" onclick="saveBudget()">OK</button>
    </div>
  `;
  const input = document.getElementById("budgetInput");
  input.focus();
  input.select();
  input.addEventListener("keydown", e => { if (e.key === "Enter") saveBudget(); });
}

function saveBudget() {
  const val = parseFloat(document.getElementById("budgetInput")?.value);
  if (!isNaN(val) && val > 0) {
    state.dailyBudget = val;
    saveState(state);
  }
  const display = document.getElementById("budgetDisplay");
  display.innerHTML = `<button class="budget-value" id="budgetBtn" onclick="startEditBudget()"></button>`;
  render();
}

function handleReset() {
  if (!confirm("Nulstil alle dine fremskridt?")) return;
  state = { days: 0, dailyBudget: state.dailyBudget, lastChecked: null, totalSaved: 0 };
  saveState(state);
  render();
}

render();

// Register service worker for offline/PWA
if ("serviceWorker" in navigator) {
  const swCode = `
    const CACHE = "ingen-indkob-v1";
    self.addEventListener("install", e => {
      e.waitUntil(caches.open(CACHE).then(c => c.addAll(["/ingen-indkob.html"])));
      self.skipWaiting();
    });
    self.addEventListener("fetch", e => {
      e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
    });
  `;
  const blob = new Blob([swCode], { type: "application/javascript" });
  const swUrl = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swUrl).catch(() => {});
}
</script>
</body>
</html>
